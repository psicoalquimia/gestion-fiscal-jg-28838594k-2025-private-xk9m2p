<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema Fiscal ‚Äî Aut√≥nomo Pro</title>
<style>
:root{--bg:#0f1117;--surface:#1a1d27;--surface2:#222535;--border:#2e3250;--accent:#6c63ff;--accent2:#a78bfa;--text:#e8eaf6;--text2:#9ca3af;--green:#10b981;--red:#ef4444;--yellow:#f59e0b;--blue:#3b82f6;}
*{box-sizing:border-box;margin:0;padding:0;}
body{background:var(--bg);color:var(--text);font-family:'Segoe UI',sans-serif;font-size:14px;line-height:1.5;}
#setupModal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.85);z-index:9999;align-items:center;justify-content:center;}
#setupModal.active{display:flex;}
.setup-box{background:var(--surface);border:1px solid var(--accent);border-radius:12px;padding:2rem;max-width:500px;width:90%;}
header{background:var(--surface);border-bottom:1px solid var(--border);padding:.8rem 1.5rem;display:flex;align-items:center;justify-content:space-between;gap:1rem;position:sticky;top:0;z-index:100;}
nav{background:var(--surface2);border-bottom:1px solid var(--border);padding:0 1.5rem;display:flex;gap:.2rem;overflow-x:auto;position:sticky;top:57px;z-index:90;}
nav button{background:none;border:none;color:var(--text2);padding:.8rem 1.2rem;cursor:pointer;border-bottom:2px solid transparent;font-size:.9rem;white-space:nowrap;}
nav button.active{color:var(--accent2);border-bottom-color:var(--accent2);background:rgba(167,139,250,0.05);}
main{padding:1.5rem;max-width:1100px;margin:0 auto;}
.tab-content{display:none;}.tab-content.active{display:block;}
.card{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:1.25rem;margin-bottom:1.25rem;}
.dash-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:1rem;margin-bottom:1.5rem;}
.dash-card{background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:1.25rem;}
.venc-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:.8rem;}
.venc-card{border:1px solid var(--border);border-radius:8px;padding:1rem;background:var(--surface2);cursor:pointer;}
.venc-card.presentado{border-color:var(--green);background:rgba(16,185,129,0.05);}
.form-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:.8rem;margin-bottom:1rem;}
.full{grid-column:1/-1;}
label{display:block;font-size:.8rem;color:var(--text2);margin-bottom:.3rem;}
input,select,textarea{width:100%;background:var(--bg);border:1px solid var(--border);color:var(--text);padding:.6rem .8rem;border-radius:6px;}
.btn{padding:.6rem 1.2rem;border-radius:6px;border:none;cursor:pointer;font-weight:600;display:inline-flex;align-items:center;justify-content:center;gap:.5rem;}
.btn-primary{background:var(--accent);color:white;}
.btn-ghost{background:var(--surface2);color:var(--text2);border:1px solid var(--border);}
.btn-danger{color:var(--red);border:1px solid var(--red);background:none;}
.table-wrap{overflow-x:auto;}
table{width:100%;border-collapse:collapse;font-size:.9rem;}
th,td{padding:.75rem 1rem;border-bottom:1px solid var(--border);text-align:left;}
.tag{padding:.2rem .5rem;border-radius:4px;font-size:.7rem;font-weight:700;}
.tag-green{background:rgba(16,185,129,0.2);color:var(--green);}
.tag-yellow{background:rgba(245,158,11,0.2);color:var(--yellow);}
.edit-mode-banner{background:rgba(245,158,11,0.1);border:1px solid var(--yellow);color:var(--yellow);padding:.7rem 1rem;border-radius:6px;margin-bottom:1rem;display:none;align-items:center;justify-content:space-between;}
</style>
</head>
<body>
<div id="setupModal">
<div class="setup-box">
<h2>‚öôÔ∏è Configuraci√≥n inicial</h2>
<div class="form-grid">
<div class="full"><label>Nombre Completo</label><input id="cfg-nombre" type="text"></div>
<div><label>NIF / NIE</label><input id="cfg-nif" type="text"></div>
</div>
<button class="btn btn-primary full" onclick="guardarConfiguracion()">Comenzar</button>
</div>
</div>
<header>
<div><h1>üìä Gesti√≥n Fiscal</h1><div id="headerInfo"></div></div>
<button class="btn btn-ghost" onclick="exportarLibroRegistro()">üì• Libro Registro</button>
</header>
<nav>
<button class="active" onclick="cambiarTab(event,'dashboard')">üè† Resumen</button>
<button onclick="cambiarTab(event,'facturas')">üßæ Facturas</button>
<button onclick="cambiarTab(event,'gastos')">üí∏ Gastos</button>
<button onclick="cambiarTab(event,'m303')">üìã Mod. 303</button>
<button onclick="cambiarTab(event,'m130')">üìã Mod. 130</button>
<button onclick="cambiarTab(event,'anuales')">üìÖ Anuales</button>
<button onclick="cambiarTab(event,'util')">üîß Ajustes</button>
</nav>
<main>
<div id="tab-dashboard" class="tab-content active">
<div class="dash-grid" id="dash-grid"></div>
<div class="card"><h3>üìÖ Calendario Fiscal</h3><div class="venc-grid" id="venc-grid"></div></div>
</div>
<div id="tab-facturas" class="tab-content">
<div class="card">
<div id="fac-edit-banner" class="edit-mode-banner"><span>‚úèÔ∏è Editando factura</span><button onclick="limpiarFormFactura()">Cancelar</button></div>
<h3>‚ûï Nueva Factura</h3>
<div class="form-grid">
<div><label>Fecha</label><input id="fac-fecha" type="date"></div>
<div><label>N¬∫</label><input id="fac-num" type="text"></div>
<div class="full"><label>Cliente</label><input id="fac-cliente" type="text"></div>
<div><label>Tipo</label><select id="fac-tipo" onchange="autoIva()"><option value="sesion">Psicolog√≠a (Exenta)</option><option value="libro">Libro Papel (4%)</option><option value="otros">Otros (21%)</option></select></div>
<div><label>Base</label><input id="fac-base" type="number" step="0.01" oninput="recalc()"></div>
<div><label>IVA %</label><input id="fac-iva-pct" type="number" value="0" oninput="recalc()"></div>
<div><label>IRPF %</label><select id="fac-irpf-pct" onchange="recalc()"><option value="0">0%</option><option value="7">7%</option><option value="15">15%</option></select></div>
</div>
<input type="hidden" id="fac-id">
<button class="btn btn-primary" onclick="guardarFactura()">Guardar</button>
</div>
<div class="card"><div class="table-wrap"><table><thead><tr><th>Fecha</th><th>N¬∫</th><th>Cliente</th><th>Base</th><th>IVA</th><th>Total</th><th></th></tr></thead><tbody id="lista-facturas"></tbody></table></div></div>
</div>
<div id="tab-gastos" class="tab-content">
<div class="card">
<h3>‚ûï Nuevo Gasto</h3>
<div class="form-grid">
<div><label>Fecha</label><input id="gas-fecha" type="date"></div>
<div class="full"><label>Concepto</label><input id="gas-prov" type="text"></div>
<div><label>Total</label><input id="gas-total" type="number" step="0.01" oninput="recalcG()"></div>
<div><label>IVA %</label><select id="gas-iva-pct" onchange="recalcG()"><option value="21">21%</option><option value="10">10%</option><option value="4">4%</option><option value="0">0%</option></select></div>
</div>
<button class="btn btn-primary" onclick="guardarGasto()">Guardar</button>
</div>
<div class="card"><div class="table-wrap"><table><thead><tr><th>Fecha</th><th>Concepto</th><th>Base</th><th>IVA</th><th>Total</th><th></th></tr></thead><tbody id="lista-gastos"></tbody></table></div></div>
</div>
<div id="tab-m303" class="tab-content"><div class="card"><h3>Modelo 303 (IVA)</h3><div id="res-303"></div></div></div>
<div id="tab-m130" class="tab-content"><div class="card"><h3>Modelo 130 (IRPF)</h3><div id="res-130"></div></div></div>
<div id="tab-anuales" class="tab-content"><div class="card"><h3>Anuales (390/190)</h3><div id="res-anual"></div></div></div>
<div id="tab-util" class="tab-content"><div class="card"><h3>üîß Ajustes</h3><button class="btn btn-ghost" onclick="reparar()">Reparar IVA</button><button class="btn btn-danger" onclick="limpiar()">Borrar Todo</button></div></div>
</main>
<script>
let facturas=[],gastos=[],config={},pres={};
function init(){
facturas=JSON.parse(localStorage.getItem('f_v3')||'[]');
gastos=JSON.parse(localStorage.getItem('g_v3')||'[]');
config=JSON.parse(localStorage.getItem('c_v3')||'{}');
pres=JSON.parse(localStorage.getItem('p_v3')||'{}');
if(!config.nombre)document.getElementById('setupModal').classList.add('active');
render();
}
function save(){
localStorage.setItem('f_v3',JSON.stringify(facturas));
localStorage.setItem('g_v3',JSON.stringify(gastos));
localStorage.setItem('c_v3',JSON.stringify(config));
localStorage.setItem('p_v3',JSON.stringify(pres));
}
function render(){
const h=document.getElementById('headerInfo');
h.innerText=config.nombre?`${config.nombre} | ${config.nif}`:'Pendiente';
const ing=facturas.reduce((s,f)=>s+f.base,0);
const gas=gastos.reduce((s,g)=>s+g.base,0);
document.getElementById('dash-grid').innerHTML=`<div class="dash-card"><label>Ingresos</label><div>${ing.toFixed(2)}‚Ç¨</div></div><div class="dash-card"><label>Gastos</label><div>${gas.toFixed(2)}‚Ç¨</div></div>`;
const vs=['4T 2025','1T 2026','2T 2026','3T 2026'];
document.getElementById('venc-grid').innerHTML=vs.map(v=>`<div class="venc-card ${pres[v]?'presentado':''}" onclick="toggleP('${v}')"><strong>${v}</strong><br><span class="tag ${pres[v]?'tag-green':'tag-yellow'}">${pres[v]?'S√ç':'NO'}</span></div>`).join('');
document.getElementById('lista-facturas').innerHTML=facturas.map(f=>`<tr><td>${f.fecha}</td><td>${f.num}</td><td>${f.cliente}</td><td>${f.base.toFixed(2)}</td><td>${f.iva.toFixed(2)}</td><td>${f.total.toFixed(2)}</td><td><button onclick="editF(${f.id})">‚úèÔ∏è</button></td></tr>`).join('');
document.getElementById('lista-gastos').innerHTML=gastos.map(g=>`<tr><td>${g.fecha}</td><td>${g.prov}</td><td>${g.base.toFixed(2)}</td><td>${g.iva.toFixed(2)}</td><td>${g.total.toFixed(2)}</td></tr>`).join('');
}
function cambiarTab(e,id){
document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));
document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
document.getElementById('tab-'+id).classList.add('active');
e.target.classList.add('active');
}
function toggleP(v){pres[v]=!pres[v];save();render();}
function autoIva(){
const t=document.getElementById('fac-tipo').value;
document.getElementById('fac-iva-pct').value=(t==='sesion')?0:(t==='libro'?4:21);
recalc();
}
function recalc(){
const b=parseFloat(document.getElementById('fac-base').value)||0;
const p=parseFloat(document.getElementById('fac-iva-pct').value)||0;
const r=parseFloat(document.getElementById('fac-irpf-pct').value)||0;
}
function guardarFactura(){
const f={id:Date.now(),fecha:document.getElementById('fac-fecha').value,num:document.getElementById('fac-num').value,cliente:document.getElementById('fac-cliente').value,base:parseFloat(document.getElementById('fac-base').value)||0,ivaPct:parseFloat(document.getElementById('fac-iva-pct').value)||0,irpfPct:parseFloat(document.getElementById('fac-irpf-pct').value)||0};
f.iva=f.base*(f.ivaPct/100);f.total=f.base+f.iva-(f.base*f.irpfPct/100);
facturas.push(f);save();render();
}
function guardarGasto(){
const t=parseFloat(document.getElementById('gas-total').value)||0,p=parseFloat(document.getElementById('gas-iva-pct').value)||0;
const b=t/(1+p/100);
gastos.push({id:Date.now(),fecha:document.getElementById('gas-fecha').value,prov:document.getElementById('gas-prov').value,total:t,base:b,iva:t-b});
save();render();
}
function guardarConfiguracion(){
config.nombre=document.getElementById('cfg-nombre').value;
config.nif=document.getElementById('cfg-nif').value;
if(config.nombre){save();document.getElementById('setupModal').classList.remove('active');render();}
}
document.addEventListener('DOMContentLoaded',init);
</script>
</body>
</html>

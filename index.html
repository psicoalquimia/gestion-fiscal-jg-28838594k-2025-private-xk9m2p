<!DOCTYPE html><html lang="es"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="robots" content="noindex, nofollow"><title>Sistema Fiscal â€” AutÃ³nomo Pro</title><style>
:root{--bg:#0f1117;--surface:#1a1d27;--surface2:#222535;--border:#2e3250;--accent:#6c63ff;--accent2:#a78bfa;--text:#e8eaf6;--text2:#9ca3af;--green:#10b981;--red:#ef4444;--yellow:#f59e0b;--blue:#3b82f6;}
*{box-sizing:border-box;margin:0;padding:0;}
body{background:var(--bg);color:var(--text);font-family:'Segoe UI',system-ui,sans-serif;font-size:15px;}
#setupModal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.85);z-index:9999;align-items:center;justify-content:center;}
#setupModal.active{display:flex;}
.setup-box{background:var(--surface);border:1px solid var(--accent);border-radius:12px;padding:2rem;max-width:520px;width:90%;}
header{background:var(--surface);border-bottom:1px solid var(--border);padding:.8rem 1.5rem;display:flex;align-items:center;justify-content:space-between;gap:1rem;flex-wrap:wrap;}
nav{background:var(--surface2);border-bottom:1px solid var(--border);padding:0 1.5rem;display:flex;gap:.2rem;overflow-x:auto;}
nav button{background:none;border:none;color:var(--text2);padding:.75rem 1.1rem;cursor:pointer;border-bottom:2px solid transparent;font-size:.9rem;white-space:nowrap;}
nav button.active{color:var(--accent2);border-bottom-color:var(--accent2);}
main{padding:1.5rem;max-width:1100px;margin:0 auto;}
.tab-content{display:none;}.tab-content.active{display:block;}
.card{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:1.25rem;margin-bottom:1.25rem;}
.dash-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;}
.dash-card{background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:1.1rem;text-align:center;}
.venc-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:.8rem;}
.venc-card{border:1px solid var(--border);border-radius:8px;padding:1rem;background:var(--surface2);cursor:pointer;transition:transform .1s;}
.venc-card:active{transform:scale(0.98);}
.venc-card.presentado{border-color:var(--green);opacity:0.8;}
.badge-presentado{background:rgba(16,185,129,0.15);color:var(--green);}
.form-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:.8rem;margin-bottom:1rem;}
.full{grid-column:1/-1;}
label{display:block;font-size:.8rem;color:var(--text2);margin-bottom:.3rem;}
input,select,textarea{width:100%;background:var(--bg);border:1px solid var(--border);color:var(--text);padding:.55rem .7rem;border-radius:6px;}
.btn{padding:.55rem 1.1rem;border-radius:6px;border:none;cursor:pointer;font-weight:600;display:inline-flex;align-items:center;gap:.4rem;}
.btn-primary{background:var(--accent);color:white;}
.btn-success{background:var(--green);color:white;}
.btn-ghost{background:var(--surface2);color:var(--text2);border:1px solid var(--border);}
.table-wrap{overflow-x:auto;}
table{width:100%;border-collapse:collapse;font-size:.85rem;}
th,td{padding:.6rem .8rem;border-bottom:1px solid var(--border);text-align:left;}
.casilla-row{display:grid;grid-template-columns:60px 1fr 140px;gap:.5rem;padding:.45rem .6rem;border-bottom:1px solid var(--border);}
.alert{padding:.75rem 1rem;border-radius:6px;font-size:.87rem;margin-bottom:.8rem;display:flex;gap:.6rem;}
.tag{padding:.15rem .45rem;border-radius:4px;font-size:.75rem;font-weight:600;}
.edit-mode-banner{background:rgba(245,158,11,.15);border:1px solid rgba(245,158,11,.4);color:var(--yellow);padding:.6rem 1rem;border-radius:6px;margin-bottom:1rem;display:none;}
@media(max-width:600px){.casilla-row{grid-template-columns:50px 1fr;}}
</style></head><body>
<div id="setupModal"><div class="setup-box"><h2>âš™ï¸ ConfiguraciÃ³n inicial</h2><div class="form-grid"><div class="full"><label>Nombre</label><input id="cfg-nombre" type="text"></div><div><label>NIF</label><input id="cfg-nif" type="text"></div></div><button class="btn btn-primary" onclick="guardarConfiguracion()">Comenzar</button></div></div>
<header><div><h1>ğŸ“Š GestiÃ³n Fiscal</h1><div id="headerInfo"></div></div><div class="header-actions"><button class="btn btn-ghost btn-sm" onclick="exportarLibroRegistro()">ğŸ“¥ Libro Registro (CSV)</button></div></header>
<nav id="mainNav"><button class="active" onclick="cambiarTab(event,'dashboard')">ğŸ  Resumen</button><button onclick="cambiarTab(event,'facturas')">ğŸ§¾ Facturas</button><button onclick="cambiarTab(event,'gastos')">ğŸ’¸ Gastos</button><button onclick="cambiarTab(event,'modelo303')">ğŸ“‹ Mod. 303</button><button onclick="cambiarTab(event,'modelo130')">ğŸ“‹ Mod. 130</button><button onclick="cambiarTab(event,'modelo390')">ğŸ“… Mod. 390 (Anual)</button><button onclick="cambiarTab(event,'modelo190')">ğŸ“… Mod. 190 (Anual)</button><button onclick="cambiarTab(event,'utilidades')">ğŸ”§ Utilidades</button></nav>
<main>
<div id="tab-dashboard" class="tab-content active"><div id="alertas-dashboard"></div><div class="dash-grid" id="dash-grid"></div><div class="card"><h3>ğŸ“… Calendario Fiscal (Click para marcar/desmarcar)</h3><div class="venc-grid" id="venc-grid"></div></div></div>
<div id="tab-facturas" class="tab-content">
<div class="card"><div id="fac-edit-banner" class="edit-mode-banner">âœï¸ Editando factura...</div><h3 id="fac-form-title">â• Nueva factura</h3><div class="form-grid"><div><label>Fecha</label><input id="fac-fecha" type="date"></div><div><label>NÃºmero</label><input id="fac-num" type="text"></div><div class="full"><label>Cliente</label><input id="fac-cliente" type="text"></div><div><label>Tipo de ingreso</label><select id="fac-tipo-ingreso" onchange="ajustarIvaPorTipo()"><option value="sesion">SesiÃ³n PsicologÃ­a (Exenta)</option><option value="libro_papel">Libro Papel Amazon (4% IVA)</option><option value="libro_ebook">Ebook / Digital (21% IVA)</option><option value="otros">Otros (21% IVA)</option></select></div><div><label>Base (â‚¬)</label><input id="fac-base" type="number" step="0.01" oninput="calcularTotalesFac()"></div><div><label>IVA (%)</label><input id="fac-iva-pct" type="number" oninput="calcularTotalesFac()"></div><div><label>RetenciÃ³n IRPF (%)</label><select id="fac-irpf-pct" onchange="calcularTotalesFac()"><option value="0">0%</option><option value="7">7%</option><option value="15">15%</option></select></div></div><input type="hidden" id="fac-edit-id"><button class="btn btn-primary" onclick="guardarFactura()">Guardar</button> <button class="btn btn-ghost" onclick="limpiarFormFactura()">Limpiar</button></div>
<div class="card"><table><thead><tr><th>NÂº</th><th>Fecha</th><th>Cliente</th><th>Base</th><th>IVA</th><th>Total</th><th></th></tr></thead><tbody id="tabla-facturas"></tbody></table></div></div>
<div id="tab-gastos" class="tab-content">
<div class="card"><h3 id="gas-form-title">â• Nuevo gasto</h3><div class="form-grid"><div><label>Fecha</label><input id="gas-fecha" type="date"></div><div class="full"><label>Proveedor</label><input id="gas-proveedor" type="text"></div><div><label>Total (â‚¬)</label><input id="gas-total" type="number" step="0.01" oninput="calcularGastoBase()"></div><div><label>Tipo IVA</label><select id="gas-iva-pct" onchange="calcularGastoBase()"><option value="21">21%</option><option value="10">10%</option><option value="4">4%</option><option value="0">Sin IVA / Exento</option></select></div><div><label>Base</label><input id="gas-base" readonly></div></div><input type="hidden" id="gas-edit-id"><button class="btn btn-primary" onclick="guardarGasto()">Guardar</button></div>
<div class="card"><table><thead><tr><th>Fecha</th><th>Proveedor</th><th>Base</th><th>IVA</th><th>Total</th><th></th></tr></thead><tbody id="tabla-gastos"></tbody></table></div></div>
<div id="tab-modelo390" class="tab-content"><div class="card"><h3>Modelo 390 â€” Resumen Anual IVA</h3><div id="m390-contenido"></div></div></div>
<div id="tab-utilidades" class="tab-content"><div class="card"><h3>ğŸ”§ Utilidades</h3><button class="btn btn-warning" onclick="repararDatosMigrados()">Reparar IVA datos antiguos</button><hr class="separator"><button class="btn btn-ghost" onclick="exportarDatos()">Exportar JSON</button><button class="btn btn-danger" onclick="borrarTodo()">Borrar Todo</button></div></div>
</main>
<script>
let facturas=[],gastos=[],estadosModelos={},config={};
function cargar(){
  facturas=JSON.parse(localStorage.getItem('facturas_v2')||'[]');
  gastos=JSON.parse(localStorage.getItem('gastos_v2')||'[]');
  estadosModelos=JSON.parse(localStorage.getItem('estadosModelos_v2')||'{}');
  config=JSON.parse(localStorage.getItem('configAutonomo')||'{}');
}
function guardar(){
  localStorage.setItem('facturas_v2',JSON.stringify(facturas));
  localStorage.setItem('gastos_v2',JSON.stringify(gastos));
  localStorage.setItem('estadosModelos_v2',JSON.stringify(estadosModelos));
}
function cambiarTab(e,t){
  document.querySelectorAll('.tab-content').forEach(x=>x.classList.remove('active'));
  document.getElementById('tab-'+t).classList.add('active');
  if(t==='dashboard')renderDashboard();
  if(t==='modelo390')calcularModelo390();
}
function ajustarIvaPorTipo(){
  const t=document.getElementById('fac-tipo-ingreso').value;
  const i=document.getElementById('fac-iva-pct');
  if(t==='sesion')i.value=0;else if(t==='libro_papel')i.value=4;else i.value=21;
  calcularTotalesFac();
}
function calcularGastoBase(){
  const t=parseFloat(document.getElementById('gas-total').value)||0,p=parseFloat(document.getElementById('gas-iva-pct').value)||0;
  document.getElementById('gas-base').value=(t/(1+p/100)).toFixed(2);
}
function renderDashboard(){
  const y=new Date().getFullYear();
  const v=['4T 2025','1T 2026','2T 2026','3T 2026'];
  document.getElementById('venc-grid').innerHTML=v.map(x=>`<div class="venc-card ${estadosModelos[x]?'presentado':''}" onclick="togglePresentado('${x}')"><strong>${x}</strong><div class="tag ${estadosModelos[x]?'tag-green':'tag-yellow'}">${estadosModelos[x]?'âœ… Presentado':'â³ Pendiente'}</div></div>`).join('');
}
function togglePresentado(id){estadosModelos[id]=!estadosModelos[id];guardar();renderDashboard();}
function exportarLibroRegistro(){
  let csv="Fecha;Numero;NIF;Cliente;Base;Tipo IVA;Cuota IVA;Total
";
  facturas.forEach(f=>csv+=`${f.fecha};${f.num};;${f.cliente};${f.base};${f.ivaPct};${f.iva};${f.total}
`);
  const blob=new Blob([csv],{type:'text/csv'});
  const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='Libro_Registro_Facturas.csv';a.click();
}
function calcularModelo390(){
  const y=new Date().getFullYear()-1;
  const fA=facturas.filter(f=>getAnyo(f.fecha)===y);
  const base4=fA.filter(f=>f.ivaPct==4).reduce((s,f)=>s+f.base,0);
  const base21=fA.filter(f=>f.ivaPct==21).reduce((s,f)=>s+f.base,0);
  const exento=fA.filter(f=>f.ivaPct==0).reduce((s,f)=>s+f.base,0);
  document.getElementById('m390-contenido').innerHTML=`<h4>Resumen Anual ${y}</h4><p>Base 4%: ${base4} â‚¬</p><p>Base 21%: ${base21} â‚¬</p><p>Operaciones Exentas: ${exento} â‚¬</p>`;
}
function getAnyo(f){return f?parseInt(f.split('-')[0]):0;}
function guardarFactura(){
  const b=parseFloat(document.getElementById('fac-base').value),p=parseFloat(document.getElementById('fac-iva-pct').value),r=parseFloat(document.getElementById('fac-irpf-pct').value);
  const f={id:Date.now(),fecha:document.getElementById('fac-fecha').value,num:document.getElementById('fac-num').value,cliente:document.getElementById('fac-cliente').value,base:b,ivaPct:p,iva:b*p/100,irpfPct:r,irpf:b*r/100,total:b+(b*p/100)-(b*r/100)};
  facturas.push(f);guardar();renderFacturas();
}
function renderFacturas(){
  document.getElementById('tabla-facturas').innerHTML=facturas.map(f=>`<tr><td>${f.num}</td><td>${f.fecha}</td><td>${f.cliente}</td><td>${f.base}</td><td>${f.iva}</td><td>${f.total}</td><td><button onclick="editarFactura(${f.id})">âœï¸</button></td></tr>`).join('');
}
document.addEventListener('DOMContentLoaded',()=>{cargar();renderDashboard();renderFacturas();});
</script></body></html>
